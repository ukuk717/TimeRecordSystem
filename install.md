## 下記内容をAGENTS.mdに従い、実装する。プロジェクト全体を必ず理解し、既存の実装/ルールと競合する内容は変更箇所の少ない安全な方を選択し、機能性を失わないように実装する。

# `Attendly`,`TimeRecordSystem`表記を変更。サービスの正式名称`Attendly`へ変更する。

- システム内の各種システム名表記を、3rd-party OAuth表記等、すべて`Attendly`へ変更する。また、メールのテンプレート、メール差し出し人等もすべて`Attendly`へ変更する。
- 現在はローカル環境で進めており、本番環境への移行は一切始まっていないため、サブドメイン/URL、S3バケット名は存在しない。また、環境変数/識別子などの外部公開をしない情報は、無駄なリスクとなるため変更しない。


# メールアドレスと氏名を変更可能にする

- `アカウント情報の変更`ページを作成し、各種変更を統一する。
    - `パスワード変更`ページでできる変更はすべて`アカウント情報の変更`ページへ統一する。
    - 新たに`メールアドレス`,`氏名`,将来的に`電話番号`の変更を可能にする。~~電話番号の変更機能はベースのみ実装し、現状は機能自体は無効化する。~~
        - メールアドレス変更時、認証コード（6桁、アカウント作成時の認証コードを要求する仕様をそのまま使う）を要求する。
            - 認証に成功しない限り、メールアドレスの変更は受け付けない。
            - メールアドレス変更後、自動ログアウト/セッション更新を行い、再ログインさせる。
        - `電話番号`はサービスが順調にシェア拡大すればすぐに有効化したいので、非活性表示をする。すぐに有効化できるよう、電話番号に関する各種実装は先に行っておく。

# 2FA関連の仕様変更

- 2FA認証方法として、メールの登録も可能にする。
    - 配送チャネルは既存のものと同様。
    - OTP桁数は6桁。
    - 有効時間は10分。
    - 再送トリガーは手動。
    - 再送間隔は1分。
    - 同時要求は最後のコードのみ有効にする。また、どちらか一方早い方のみを受け付ける（同時要求は制限する）。
    - 認証手段はユーザーに選ばせる。どちらか一方のみ登録の場合は、登録されている2FA手段を自動で選択する。
    - 再設定中のユーザーは、2FA情報がすべてリセットされているため初期状態から登録させる。
    - 認証失敗時の再送は5回まで。5回とも失敗した場合、10分の認証不能時間を設ける。ただし、TOTPにも登録済のアカウントは、メールは通らないがTOTPでの認証は認証不能時間でも可能にする。
        - 同時に、TOTPも5回認証に失敗すると10分の認証不能時間を設ける。
- 2FA登録済アカウントがメールアドレス変更時、変更前に2FA認証を行ったうえで、変更を受け付ける。
    - 2FA未登録ユーザーは従来通り、2FA認証は不要。メール確認なしで変更可能。

# アカウント仕様変更

- アカウント作成時に、メールアドレスの認証（ワンタイムコード）を求める機能を追加する。
    - アカウント情報入力後、登録前にワンタイムコードを記載したメールを送信するようにする。
    - 認証コードを入力し、認証が成功した場合登録する。失敗した場合~~も入力内容は保持する（可能なら）。~~は登録を拒否し、最初から登録させる。
    - 従業員アカウントが認証失敗時、ロールコードの回数を消費しないようにする。
    - 認証コードの要求のtrue/falseはダッシュボードからテナント管理者が設定できるようにする。
    - 利便性向上のため、通常はfalseで設定。
